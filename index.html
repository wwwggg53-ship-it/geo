<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–ª–∏–∂–∞–π—à–∞—è —Ç–æ—á–∫–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            font-size: 2rem;
            color: #4CAF50;
        }
        #nearest-point {
            font-size: 1.5rem;
            margin-top: 20px;
            color: #007BFF;
        }
        footer {
            margin-top: 50px;
            font-size: 0.9rem;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
    <div id="coordinates">–û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...</div>
    <div id="nearest-point">–ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏...</div>
    <footer>
        –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const coordinatesElement = document.getElementById('coordinates');
            const nearestPointElement = document.getElementById('nearest-point');

            // –î–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Google Sheets (–≤—Ä—É—á–Ω—É—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã)
            const points = [
                { name: "üèó –í–æ–ª–æ–∫–Ω–æ", coeff: 13, coords: [51.669036, 36.081342] },
                { name: "üèù –ü–∞—Ä–∫–æ–≤–∞—è", coeff: 11, coords: [51.669848, 36.142218] },
                { name: "‚ö†Ô∏è –≠–Ω–≥–µ–ª—å—Å–∞", coeff: 12, coords: [51.699032, 36.157341] },
                { name: "üõ†Ô∏è –ö–ó–¢–ó", coeff: 13, coords: [51.708878, 36.146305] },
                { name: "üè¢ –ö–ª—ã–∫–æ–≤–∞", coeff: 12, coords: [51.721887, 36.134499] },
                { name: "üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∞—è", coeff: 13, coords: [51.741065, 36.145612] },
                { name: "üèüÔ∏è –ú–∞–Ω–µ–∂", coeff: 12, coords: [51.726253, 36.174996] },
                { name: "üçî –¶–µ–Ω—Ç—Ä", coeff: 9, coords: [51.726875, 36.185927] },
                { name: "üçî –õ–µ–Ω–∏–Ω–∞", coeff: 9, coords: [51.734405, 36.192233] },
                { name: "üïå –¶–ü", coeff: 13, coords: [51.749037, 36.191202] },
                { name: "‚õ∫ –ú–µ–≥–∞–ì—Ä–∏–Ω–Ω", coeff: 12, coords: [51.762106, 36.183389] },
                { name: "üéâ –ü–æ–±–µ–¥–∞", coeff: 10, coords: [51.777857, 36.174806] },
                { name: "üè¢ –î–∏—Ä–∏–∫", coeff: 13, coords: [51.811114, 36.165550] },
                { name: "üêÄ –ú—É—Ä–∫–∞", coeff: 13, coords: [51.757586, 36.225593] }
            ];

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ –•–∞–≤–µ—Ä—Å–∏–Ω–∞
            function calculateDistance(lat1, lon1, lat2, lon2) {
                const toRad = (value) => (value * Math.PI) / 180;
                const R = 6371; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –∫–º

                const dLat = toRad(lat2 - lat1);
                const dLon = toRad(lon2 - lon1);

                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);

                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–º
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏
            function findNearestPoint(userLat, userLon) {
                let nearestPoint = null;
                let minDistance = Infinity;

                for (const point of points) {
                    const distance = calculateDistance(userLat, userLon, point.coords[0], point.coords[1]);
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestPoint = point;
                    }
                }

                return nearestPoint;
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            function updateCoordinates(position) {
                const latitude = position.coords.latitude.toFixed(6);
                const longitude = position.coords.longitude.toFixed(6);
                coordinatesElement.innerHTML = `–í–∞—à–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <strong>${latitude}, ${longitude}</strong>`;

                // –ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏
                const nearestPoint = findNearestPoint(latitude, longitude);
                if (nearestPoint) {
                    nearestPointElement.innerHTML = `–ë–ª–∏–∂–∞–π—à–∞—è —Ç–æ—á–∫–∞: <strong>${nearestPoint.name}</strong> (+${nearestPoint.coeff})`;
                } else {
                    nearestPointElement.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à—É—é —Ç–æ—á–∫—É.';
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
            function handleError(error) {
                coordinatesElement.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.';
                nearestPointElement.textContent = '–ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.';
                console.error('–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', error.message);
            }

            // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(updateCoordinates, handleError, {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                });
            } else {
                coordinatesElement.textContent = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è.';
                nearestPointElement.textContent = '–ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.';
            }
        });
    </script>
</body>
</html>
