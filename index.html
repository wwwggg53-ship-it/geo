<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отслеживание метки и координат</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            font-size: 2rem;
            color: #4CAF50;
        }
        #coordinates {
            font-size: 1.2rem;
            margin-top: 20px;
            color: #555;
        }
        footer {
            margin-top: 50px;
            font-size: 0.9rem;
            color: #777;
        }
    </style>
</head>
<body>
    <h1>Добро пожаловать, <span id="tag">Гость</span></h1>
    <div id="coordinates">Ожидание координат...</div>
    <footer>
        Переместитесь, чтобы обновить координаты.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tagElement = document.getElementById('tag');
            const coordinatesElement = document.getElementById('coordinates');

            // Получаем метку из URL
            const urlParams = new URLSearchParams(window.location.search);
            let userTag = 'Гость'; // Значение по умолчанию

            for (const [key] of urlParams.entries()) {
                if (key === 'Annenkof') {
                    userTag = key; // Сохраняем метку
                    break;
                }
            }

            // Отображаем метку
            tagElement.textContent = userTag;

            // Удаляем метку из URL
            if (urlParams.has('Annenkof')) {
                history.replaceState(null, '', window.location.pathname); // Очищаем URL
            }

            // Функция для обновления координат
            function updateCoordinates(position) {
                const latitude = position.coords.latitude.toFixed(6);
                const longitude = position.coords.longitude.toFixed(6);
                coordinatesElement.innerHTML = `Ваши координаты: <strong>${latitude}, ${longitude}</strong>`;
            }

            // Функция для обработки ошибок геолокации
            function handleError(error) {
                coordinatesElement.textContent = 'Не удалось получить координаты.';
                console.error('Ошибка геолокации:', error.message);
            }

            // Начинаем отслеживать координаты
            if (navigator.geolocation) {
                const watchId = navigator.geolocation.watchPosition(updateCoordinates, handleError, {
                    enableHighAccuracy: true, // Включаем высокую точность
                    timeout: 5000,           // Таймаут для получения координат
                    maximumAge: 0            // Не используем кэшированные данные
                });
            } else {
                coordinatesElement.textContent = 'Ваш браузер не поддерживает функцию определения местоположения.';
            }
        });
    </script>
</body>
</html>
